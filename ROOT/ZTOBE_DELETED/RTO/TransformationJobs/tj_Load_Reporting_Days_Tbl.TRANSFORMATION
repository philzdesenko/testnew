{"job":{"components":{"19411":{"id":19411,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":288,"y":256,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[19413],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL_REPORTING_DAYS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select \nFIRST_REF_TABLE.\"ACCOUNTOBJECTID\",\nFIRST_REF_TABLE.\"DAY\",\nSECOND_REF_TABLE.\"ALLIPADDRESS\",\nFIRST_REF_TABLE.\"INOFFICE\",\nFIRST_REF_TABLE.\"TZ\"\nFROM\n(\nSELECT DISTINCT\n\"ACCOUNTOBJECTID\",\n\"DAY\",\n\"TZ\",\nMAX(\"INOFFICE\") OVER (PARTITION BY \"ACCOUNTOBJECTID\",\"DAY\") AS \"INOFFICE\"\nFROM\n(\nSELECT \n\"ACCOUNTOBJECTID\", \n\"TIMESTAMP\", \n\"utc_offset\", \n\"IPADDRESS\", \niff(\"utc_offset\"='NULL','-419',\"utc_offset\") AS \"TZ\", \nDATEADD(minute, ( iff(\"utc_offset\"='NULL','-419',\"utc_offset\") )::NUMBER, \"TIMESTAMP\"::TIMESTAMP)::DATE AS \"DAY\",\nIFF(startswith(\"IPADDRESS\",'10.1.') or startswith(\"IPADDRESS\",'10.2.') or startswith(\"IPADDRESS\",'10.40.') or startswith(\"IPADDRESS\",'10.96.') or startswith(\"IPADDRESS\",'10.97.') or startswith(\"IPADDRESS\",'10.98.') or startswith(\"IPADDRESS\",'10.99.') or startswith(\"IPADDRESS\",'10.100.') or startswith(\"IPADDRESS\",'10.101.') or startswith(\"IPADDRESS\",'10.102.') or startswith(\"IPADDRESS\",'10.103.') or startswith(\"IPADDRESS\",'10.104.') or startswith(\"IPADDRESS\",'10.105.') or startswith(\"IPADDRESS\",'10.106.') or startswith(\"IPADDRESS\",'10.107.') or startswith(\"IPADDRESS\",'10.108.') or startswith(\"IPADDRESS\",'10.112.') or startswith(\"IPADDRESS\",'10.113.') or startswith(\"IPADDRESS\",'10.114.') or startswith(\"IPADDRESS\",'10.115.') or startswith(\"IPADDRESS\",'10.116.') or startswith(\"IPADDRESS\",'10.117.') or startswith(\"IPADDRESS\",'10.118.') or startswith(\"IPADDRESS\",'10.119.') or startswith(\"IPADDRESS\",'10.120.') or startswith(\"IPADDRESS\",'10.128.') or startswith(\"IPADDRESS\",'10.129.') or startswith(\"IPADDRESS\",'10.130.') or startswith(\"IPADDRESS\",'10.131.') or startswith(\"IPADDRESS\",'10.132.') or startswith(\"IPADDRESS\",'10.133.') or startswith(\"IPADDRESS\",'10.134.') or startswith(\"IPADDRESS\",'10.135.') or startswith(\"IPADDRESS\",'10.136.') or startswith(\"IPADDRESS\",'10.140.') or startswith(\"IPADDRESS\",'10.141.') or startswith(\"IPADDRESS\",'10.142.') or startswith(\"IPADDRESS\",'10.144.') or startswith(\"IPADDRESS\",'10.145.') or startswith(\"IPADDRESS\",'10.146.') or startswith(\"IPADDRESS\",'10.147.') or startswith(\"IPADDRESS\",'10.148.') or startswith(\"IPADDRESS\",'10.160.') or startswith(\"IPADDRESS\",'10.161.') or startswith(\"IPADDRESS\",'10.162.') or startswith(\"IPADDRESS\",'10.163.') or startswith(\"IPADDRESS\",'10.165.') or startswith(\"IPADDRESS\",'10.166.') or startswith(\"IPADDRESS\",'10.167.') or startswith(\"IPADDRESS\",'10.168.') or startswith(\"IPADDRESS\",'10.169.') or startswith(\"IPADDRESS\",'10.170.') or startswith(\"IPADDRESS\",'10.176.') or startswith(\"IPADDRESS\",'10.177.') or startswith(\"IPADDRESS\",'10.178.'),1,\nIFF(startswith(\"IPADDRESS\",'10.247.48.') or startswith(\"IPADDRESS\",'10.247.49.') or startswith(\"IPADDRESS\",'10.247.50.') or startswith(\"IPADDRESS\",'10.247.51.') or startswith(\"IPADDRESS\",'10.173.') or startswith(\"IPADDRESS\",'10.199.') or startswith(\"IPADDRESS\",'10.41.200.') or startswith(\"IPADDRESS\",'10.41.201.') or startswith(\"IPADDRESS\",'10.41.202.') or startswith(\"IPADDRESS\",'10.41.203.') or startswith(\"IPADDRESS\",'10.41.204.') or startswith(\"IPADDRESS\",'10.41.205.') or startswith(\"IPADDRESS\",'10.41.206.') or startswith(\"IPADDRESS\",'10.41.207.') or startswith(\"IPADDRESS\",'10.41.208.') or startswith(\"IPADDRESS\",'10.41.209.') or startswith(\"IPADDRESS\",'10.41.210.') or startswith(\"IPADDRESS\",'10.41.211.') or startswith(\"IPADDRESS\",'10.41.212.') or startswith(\"IPADDRESS\",'10.41.213.') or startswith(\"IPADDRESS\",'10.41.214.') or startswith(\"IPADDRESS\",'10.41.215.') or startswith(\"IPADDRESS\",'10.41.216.') or startswith(\"IPADDRESS\",'10.41.217.') or startswith(\"IPADDRESS\",'10.41.218.') or startswith(\"IPADDRESS\",'10.41.219.') or startswith(\"IPADDRESS\",'10.41.220.') or startswith(\"IPADDRESS\",'10.41.221.') or startswith(\"IPADDRESS\",'10.41.222.') or startswith(\"IPADDRESS\",'10.41.223.') or startswith(\"IPADDRESS\",'10.41.224.') or startswith(\"IPADDRESS\",'10.41.225.') or startswith(\"IPADDRESS\",'10.41.226.') or startswith(\"IPADDRESS\",'10.41.227.') or startswith(\"IPADDRESS\",'10.41.228.') or startswith(\"IPADDRESS\",'10.41.229.') or startswith(\"IPADDRESS\",'10.41.230.') or startswith(\"IPADDRESS\",'10.41.231.') or startswith(\"IPADDRESS\",'10.42'),0,-1))\nAS \"INOFFICE\"\nFROM \n(\nSELECT \n\"main\".\"ACCOUNTOBJECTID\" AS \"ACCOUNTOBJECTID\",\"main\".\"TIMESTAMP\" AS \"TIMESTAMP\",\n\"JNR_LOCATION\".\"utc_offset\" AS \"utc_offset\",\"main\".\"IPADDRESS\" AS \"IPADDRESS\" \nFROM \n(select ACCOUNTOBJECTID,TIMESTAMP,IPADDRESS from DATA_LAKE.AZURE_ATP.ATP_ACTIVITIES) AS \"main\" \nINNER JOIN \n(SELECT \"GUID\",\"LOCATION_ID\" FROM \"DATA_LAKE\".\"SERVICENOW\".\"USER_DETAILS_VW\") AS \"JNR_GUID\" \nON \"JNR_GUID\".\"GUID\"=\"main\".\"ACCOUNTOBJECTID\" \nINNER JOIN \n(SELECT \"LOCATION\",\"utc_offset\" FROM \"DATA_LAKE\".\"AZURE_ATP\".\"ENRICHED_LOCATION\") AS \"JNR_LOCATION\" \nON ltrim(\"JNR_GUID\".\"LOCATION_ID\")=\"JNR_LOCATION\".\"LOCATION\"\n))\n) FIRST_REF_TABLE,\n(\nSELECT \n\"ACCOUNTOBJECTID\",\nDATEADD(minute, ( iff(\"utc_offset\"='NULL','-419',\"utc_offset\") )::NUMBER, \"TIMESTAMP\"::TIMESTAMP)::DATE AS \"DAY\",\nLISTAGG(\"IPADDRESS\",',') as \"ALLIPADDRESS\"\nFROM \n(\nSELECT \n\"main\".\"ACCOUNTOBJECTID\" AS \"ACCOUNTOBJECTID\",\"main\".\"TIMESTAMP\" AS \"TIMESTAMP\",\n\"JNR_LOCATION\".\"utc_offset\" AS \"utc_offset\",\"main\".\"IPADDRESS\" AS \"IPADDRESS\" \nFROM \n(select ACCOUNTOBJECTID,TIMESTAMP,IPADDRESS from DATA_LAKE.AZURE_ATP.ATP_ACTIVITIES) AS \"main\" \nINNER JOIN \n(SELECT \"GUID\",\"LOCATION_ID\" FROM \"DATA_LAKE\".\"SERVICENOW\".\"USER_DETAILS_VW\") AS \"JNR_GUID\" \nON \"JNR_GUID\".\"GUID\"=\"main\".\"ACCOUNTOBJECTID\" \nINNER JOIN \n(SELECT \"LOCATION\",\"utc_offset\" FROM \"DATA_LAKE\".\"AZURE_ATP\".\"ENRICHED_LOCATION\") AS \"JNR_LOCATION\" \nON ltrim(\"JNR_GUID\".\"LOCATION_ID\")=\"JNR_LOCATION\".\"LOCATION\"\n) \ngroup by 1,2\n) SECOND_REF_TABLE where \nFIRST_REF_TABLE.ACCOUNTOBJECTID=SECOND_REF_TABLE.ACCOUNTOBJECTID AND\nFIRST_REF_TABLE.DAY=SECOND_REF_TABLE.DAY AND\n(FIRST_REF_TABLE.ACCOUNTOBJECTID,FIRST_REF_TABLE.DAY) NOT IN \n(SELECT DISTINCT OBJECTGUID,DAY FROM DATA_LAKE.AZURE_ATP.ATP_ACTIVITIES_REPORT_DAYS\nwhere OBJECTGUID is not null and DAY is not null)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"19412":{"id":19412,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":432,"y":256,"width":32,"height":32,"inputConnectorIDs":[19413],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ATP_ACTIVITIES_REPORT_DAYS"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ATP_ACTIVITIES_REPORT_DAYS"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNTOBJECTID"},"2":{"slot":2,"type":"STRING","value":"OBJECTGUID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"DAY"},"2":{"slot":2,"type":"STRING","value":"DAY"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"INOFFICE"},"2":{"slot":2,"type":"STRING","value":"INOFFICE"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"TZ"},"2":{"slot":2,"type":"STRING","value":"TZ"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"ALLIPADDRESS"},"2":{"slot":2,"type":"STRING","value":"IPADDRESSES"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AZURE_ATP"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATA_LAKE"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"19413":{"id":19413,"sourceID":19411,"targetID":19412}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"tj_Load_Reporting_Days_Tbl","description":null,"type":"TRANSFORMATION","tag":"dd29f611-c285-4a9b-afaf-24e1b4b6aeed"}}