{"job":{"components":{"79978":{"id":79978,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":304,"y":320,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[79983],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Staging Table"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stage_table_name}"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"columns"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stage_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stage_database}"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"79980":{"id":79980,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":464,"y":320,"width":32,"height":32,"inputConnectorIDs":[79983],"outputConnectorIDs":[79982],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Add audit data"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CAST(${run_history_id} AS INT)"},"2":{"slot":2,"type":"STRING","value":"MATILLION_BATCH_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"MATILLION_UPDATED_TIMESTAMP"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"79981":{"id":79981,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":624,"y":320,"width":32,"height":32,"inputConnectorIDs":[79982],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Target Table"}}}},"visible":true},"200":{"slot":200,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_table_name}"}}}},"visible":true},"201":{"slot":201,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_schema}"}}}},"visible":true},"202":{"slot":202,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_database}"}}}},"visible":true},"203":{"slot":203,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_warehouse}"}}}},"visible":true},"206":{"slot":206,"name":"Join Expression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${join_statement}"},"2":{"slot":2,"type":"STRING","value":"Join"}}}},"visible":true},"207":{"slot":207,"name":"When Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${join_statement}"},"2":{"slot":2,"type":"STRING","value":"Update"}}}},"visible":true},"208":{"slot":208,"name":"Update Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_columns"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"},"2":{"slot":2,"type":"GRID","value":"column_name"}}}},"visible":true},"209":{"slot":209,"name":"Include Not Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"210":{"slot":210,"name":"Insert Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_columns"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"},"2":{"slot":2,"type":"GRID","value":"column_name"}}}},"visible":true}},"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Rows Deleted","mapTo":"logged_rows_deleted"},"2":{"slot":2,"fromId":null,"fromName":"Message","mapTo":"errorMessage"},"3":{"slot":3,"fromId":null,"fromName":"Rows Inserted","mapTo":"logged_rows_inserted"},"4":{"slot":4,"fromId":null,"fromName":"Rows Updated","mapTo":"logged_rows_update"}},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"79982":{"id":79982,"sourceID":79980,"targetID":79981},"79983":{"id":79983,"sourceID":79978,"targetID":79980}},"notes":{"79979":{"id":79979,"x":245,"y":166,"width":464,"height":102,"text":"** UPSERT ** \nThis job will take the staging table and use it to update changed rows and insert new rows into the target table.\n\nA grid variable __key_columns__ is used to provide the unique key(s) for the UPSERT. The key(s) are set by a previous process and should be defined by the source list of tables and columns.","colour":"f9c21b"}},"noteConnectors":{},"variables":{"dist_style":{"definition":{"name":"dist_style","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"errorMessage":{"definition":{"name":"errorMessage","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"incremental_column":{"definition":{"name":"incremental_column","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"join_statement":{"definition":{"name":"join_statement","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"logged_rows_deleted":{"definition":{"name":"logged_rows_deleted","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"},"logged_rows_inserted":{"definition":{"name":"logged_rows_inserted","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"},"logged_rows_update":{"definition":{"name":"logged_rows_update","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"},"stage_database":{"definition":{"name":"stage_database","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"stage_dataset":{"definition":{"name":"stage_dataset","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"stage_project":{"definition":{"name":"stage_project","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"stage_schema":{"definition":{"name":"stage_schema","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"stage_table_name":{"definition":{"name":"stage_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"stage_warehouse":{"definition":{"name":"stage_warehouse","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"sub_RangeStartDate":{"definition":{"name":"sub_RangeStartDate","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_database":{"definition":{"name":"target_database","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_dataset":{"definition":{"name":"target_dataset","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_project":{"definition":{"name":"target_project","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_schema":{"definition":{"name":"target_schema","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_table_name":{"definition":{"name":"target_table_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"target_warehouse":{"definition":{"name":"target_warehouse","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"columns":{"definition":{"name":"columns","scope":"BRANCH","definitions":[{"name":"column_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["Isdeleted"]},{"values":["companyId"]}]},"key_columns":{"definition":{"name":"key_columns","scope":"BRANCH","definitions":[{"name":"column_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"target_columns":{"definition":{"name":"target_columns","scope":"BRANCH","definitions":[{"name":"column_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Incremental lib load target - UPSERT","description":"Unpacked from Shared Job [Load Target].","type":"TRANSFORMATION","tag":"da102159-6c3d-4e86-b113-bf8e7fc19565"}}