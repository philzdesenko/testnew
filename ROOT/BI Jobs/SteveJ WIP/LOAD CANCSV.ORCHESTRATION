{"job":{"components":{"80796":{"id":80796,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1611478312,"x":160,"y":0,"width":32,"height":32,"inputConnectorIDs":[80751],"outputSuccessConnectorIDs":[80800],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create Table 0"}}}},"visible":true},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PZ_DATABASE"}}}},"visible":true},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCRATCH"}}}},"visible":true},"4":{"slot":4,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CANCSV"}}}},"visible":true},"5":{"slot":5,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"YEARNO"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"INTEGER","value":""},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"No"},"7":{"slot":7,"type":"STRING","value":"No"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"DATA"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"INTEGER","value":""},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"No"},"7":{"slot":7,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Create/Replace","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Replace"}}}},"visible":true},"7":{"slot":7,"name":"Clustering Keys","elements":{},"visible":true},"8":{"slot":8,"name":"Data Retention Time in Days","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"9":{"slot":9,"name":"Comment","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"11":{"slot":11,"name":"Primary Keys","elements":{},"visible":true},"12":{"slot":12,"name":"Table Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Permanent"}}}},"visible":true},"13":{"slot":13,"name":"Default DDL Collation","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"80798":{"id":80798,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[80751],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"80799":{"id":80799,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":320,"y":0,"width":32,"height":32,"inputConnectorIDs":[80800],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print (myvar)\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print (context.getGridVariable('mygridvar'))\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nimport requests\n\nurl = 'http://climatedataapi.worldbank.org/climateweb/rest/v1/country/cru/tas/year/CAN.csv'\n\nresponse = requests.get(url)\nif response.status_code != 200:\n  print('Failed to get data:', response.status_code)\n\n#initialise strings\ntemp=\"\"\nyear=\"\"\ndata=\"\"\n\nsfCursor = context.cursor()\n\n#loop through 128 char strings in response\n#after skipping past the header, search for year,data pairs to insert as follows\n#copy each char to a temp string until we find a comma, which means we have a year so copy temp into the year variable\n#continue until we find a \\n (EOL) and then we have a the value so again copy temp into the data variable\n#now insert into the target table, clear the variables and repeat\nfor row in response:\n  print('processing: ')\n  print(row)\n  print('end!')\n\n  #initialise/reset counts\n  i=0\n  j=len(row)\n  \n  while i < j:\n    #print(\"char: \"+row[i])\n\n    #ignore header\n    if row[i:10]==\"year,data\\n\":\n      i=i+10\n\n    #check for EOL which marks end of a year,data pair\n    if row[i]=='\\n':\n      data=temp\n      print(\"inserting \"+year+\" and \"+data)\n\n      insert = \"\"\"insert into SCRATCH.CANCSV(YEARNO,DATA) values ('\"\"\" + year + \"\"\"','\"\"\" + data + \"\"\"');\"\"\"\n      print insert\n      sfCursor.execute(insert)\n      \n      temp=\"\"\n      year=\"\"\n      data=\"\"\n    #check for , which marks end of a year\n    elif row[i]==',':\n      year=temp\n      temp=\"\"\n    #otherwise add char to str\n    else:\n      temp=temp+row[i]\n  \n    i=i+1\n    \n  #year,data pair may straddle rows\n  if temp!='':  \n    data=temp\n    print(\"carrying over \"+year+\" and \"+data)\n\n#unless theres a truncation error etc, we should end on a year,data pair but still need to insert it\nif temp!='':  \n  data=temp\n  print(\"inserting \"+year+\" and \"+data)\n  insert = \"\"\"insert into SCRATCH.CANCSV(YEARNO,DATA) values ('\"\"\" + year + \"\"\"','\"\"\" + data + \"\"\"');\"\"\"\n  print insert\n  sfCursor.execute(insert)\n    "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"80800":{"id":80800,"sourceID":80796,"targetID":80799}},"failureConnectors":{},"unconditionalConnectors":{"80751":{"id":80751,"sourceID":80798,"targetID":80796}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"LOAD CANCSV","description":"","type":"ORCHESTRATION","tag":"fb31bc07-3247-4966-b7e6-f785d015f331"}}